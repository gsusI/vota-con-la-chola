(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,17374,e=>{"use strict";var s=e.i(43476),t=e.i(71645);function a(){return"/vota-con-la-chola"}function i(e){return String(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function r(e){let s=Number(e);return Number.isFinite(s)?s:0}function n(e){if(null==e||Number.isNaN(e))return"—";let s=Number(e);return Number.isFinite(s)?`${(100*s).toFixed(1)}%`:"—"}function o(e){if(null==e||Number.isNaN(e))return"—";let s=Number(e);return Number.isFinite(s)?s.toFixed(2):"—"}function l(e){let s=Number(e);return Number.isFinite(s)?Math.max(0,Math.min(1,s)):0}function c(e){return String(e||"—")}function d(e){switch(String(e||"").toLowerCase()){case"support":case"supportive":return"pill-success";case"oppose":return"pill-danger";case"mixed":return"pill-warning";default:return"pill-muted"}}function p(e){let s=String(e||"").toLowerCase();return"combined"===s?0:"votes"===s?1:"declared"===s?2:3}function h(){let e=new URLSearchParams(window.location.search);return{mode:String(e.get("mode")||"person"),q:String(e.get("q")||""),method:String(e.get("method")||"all"),stance:String(e.get("stance")||"all"),topic:String(e.get("topic")||""),party:String(e.get("party")||""),sort:String(e.get("sort")||"person"),limit:Number(e.get("limit")||180)}}function m(e){let s=r(e?.review_summary?.pending||0),t=r(e?.review_summary?.resolved||0),a=r(e?.review_summary?.ignored||0);return s||t||a?`Pendiente ${s} \xb7 Aprobada ${t} \xb7 Ignorada ${a}`:"Sin revisión registrada"}function u(){let{loading:e,error:u,data:x}=function(){let[e,s]=(0,t.useState)({loading:!0,error:null,data:null});return(0,t.useEffect)(()=>{let e=new AbortController;return fetch(`${a()}/political-positions/data/stances.json`,{signal:e.signal}).then(e=>{if(!e.ok)throw Error(`Respuesta no v\xe1lida: ${e.status}`);return e.json()}).then(e=>{s({loading:!1,error:null,data:e})}).catch(e=>{"AbortError"!==e.name&&s({loading:!1,error:e.message||String(e),data:null})}),()=>e.abort()},[]),e}(),[j,g]=(0,t.useState)(()=>h()),[v,_]=(0,t.useState)(null);(0,t.useEffect)(()=>{let e=h();g({...e,limit:Number.isFinite(e.limit)&&e.limit>0?Math.min(e.limit,400):180})},[]),(0,t.useEffect)(()=>{let e=new URLSearchParams;j.mode&&"person"!==j.mode&&e.set("mode",j.mode),j.q&&e.set("q",j.q),j.method&&"all"!==j.method&&e.set("method",j.method),j.stance&&"all"!==j.stance&&e.set("stance",j.stance),j.topic&&e.set("topic",j.topic),j.party&&e.set("party",j.party),j.sort&&"person"!==j.sort&&e.set("sort",j.sort),r(j.limit||0)>0&&180!==r(j.limit)&&e.set("limit",String(r(j.limit)));let s=e.toString(),t=`${window.location.pathname}${s?`?${s}`:""}`;window.history.replaceState({},"",t)},[j.mode,j.q,j.method,j.stance,j.topic,j.party,j.sort,j.limit]);let f=(0,t.useMemo)(()=>{let e=new Map;for(let s of x?.topics||[])e.set(r(s.topic_id),{topic_id:r(s.topic_id),label:String(s.topic_label||s.label||"").trim(),key:String(s.topic_key||"").trim()});return e},[x?.topics]),b=(0,t.useMemo)(()=>{let e=new Map;for(let s of x?.persons||[])e.set(r(s.person_id),{person_id:r(s.person_id),full_name:String(s.full_name||s.name||"").trim(),canonical_key:String(s.canonical_key||"").trim(),point_count:r(s.point_count||0),latest_as_of:String(s.latest_as_of||"")});return e},[x?.persons]),y=(0,t.useMemo)(()=>{let e=new Map;for(let s of x?.parties||[])e.set(r(s.party_id),{party_id:r(s.party_id),name:String(s.name||s.party||"").trim(),acronym:String(s.acronym||"").trim()});return e},[x?.parties]),S=(0,t.useMemo)(()=>{let e=String(j.mode||"person"),s=i(j.q),t=String(j.method||"all").trim().toLowerCase(),a=String(j.stance||"all").trim().toLowerCase(),n=i(j.topic),o=i(j.party),c=[];if(!x?.person_trajectories||"object"!=typeof x.person_trajectories)return c;if("party"===e)for(let[e,d]of Object.entries(x?.party_trajectories||{})){let p=y.get(r(e));if(!p)continue;let h=`${p.name||`Partido ${p.party_id}`}`+(p.acronym?` (${p.acronym})`:"");if(!o||i(h).includes(o))for(let e of Array.isArray(d)?d:[]){let o=f.get(r(e.topic_id))||{},d=String(e.topic_label||o.label||"").trim(),m=i(j.topic?e.topic_key||o.key:d);if(n&&!m.includes(n))continue;let u=String(e.computed_method||"").toLowerCase();if("all"!==t&&u!==t)continue;let x=String(e.stance||"").toLowerCase();("all"===a||x===a)&&(!s||[d,h,String(e.as_of_date||""),String(e.computed_version||""),e.party_label||""].map(i).some(e=>e.includes(s)))&&c.push({scope:"party",key:`p-${p.party_id}-${o.topic_id||0}-${e.as_of_date||""}-${u}`,partyId:p.party_id,partyLabel:h,party:p,personId:0,personName:"",topicId:r(e.topic_id||0),topicLabel:d,topicKey:String(o.key||e.topic_key||""),asOf:String(e.as_of_date||""),windowDays:r(e.window_days),method:u,stance:x,score:l(e.score),confidence:l(e.confidence),evidenceCount:r(e.evidence_count||0),lastEvidenceDate:String(e.last_evidence_date||""),coverage:e.coverage||e,evidenceBreakdown:e.evidence_breakdown||{},reviewSummary:e.review_summary||{},samples:Array.isArray(e.evidence_samples)?e.evidence_samples:[],raw:e})}}else for(let[e,d]of Object.entries(x.person_trajectories||{})){let p=b.get(r(e));if(p)for(let h of Array.isArray(d)?d:[]){let d=f.get(r(h.topic_id))||{},m=String(h.topic_label||d.label||"").trim(),u=i(j.topic?h.topic_key||d.key:m);if(n&&!u.includes(n))continue;let x=String(h.computed_method||"").toLowerCase();if("all"!==t&&x!==t)continue;let g=String(h.stance||"").toLowerCase();if("all"!==a&&g!==a)continue;let v=[String(p.full_name||""),String(p.canonical_key||""),String(m||""),String(h.party_label||""),String(h.as_of_date||""),String(x||""),String(h.topic_key||"")].map(i).join(" ");if(!s||v.includes(s)){if(o&&!i(h.party_label||"").includes(o))continue;c.push({scope:"person",key:`i-${e}-${d.topic_id||0}-${h.as_of_date||""}-${x}`,personId:r(p.person_id||e),personName:String(p.full_name||""),person:p,partyId:r(h.party_id||0),partyLabel:String(h.party_label||""),topicId:r(h.topic_id||0),topicLabel:m,topicKey:String(h.topic_key||d.key||""),asOf:String(h.as_of_date||""),windowDays:r(h.window_days),method:x,stance:g,score:l(h.score),confidence:l(h.confidence),evidenceCount:r(h.evidence_count||0),lastEvidenceDate:String(h.last_evidence_date||""),coverage:h.coverage||h,evidenceBreakdown:h.evidence_breakdown||{},reviewSummary:h.review_summary||{},samples:Array.isArray(h.evidence_samples)?h.evidence_samples:[],raw:h})}}}let d=String(j.sort||"person");c.sort((e,s)=>{if("confidence_desc"===d)return l(s.confidence)-l(e.confidence)||s.score-e.score||s.evidenceCount-e.evidenceCount;if("confidence_asc"===d)return l(e.confidence)-l(s.confidence)||e.score-s.score;if("method"===d&&e.method!==s.method)return p(e.method)-p(s.method);if("stance"===d&&e.stance!==s.stance)return String(e.stance).localeCompare(String(s.stance));if("as_of"===d)return String(s.asOf||"").localeCompare(String(e.asOf||""));if("topic"===d)return String(e.topicLabel||"").localeCompare(String(s.topicLabel||""))||String(e.asOf||"").localeCompare(String(s.asOf||""));if("party"===d){let t=i(e.partyLabel||""),a=i(s.partyLabel||"");if(t!==a)return t.localeCompare(a)}return e.scope===s.scope?"person"===e.scope?String(e.personName||"").localeCompare(String(s.personName||""))||String(e.topicLabel||"").localeCompare(String(s.topicLabel||""))||String(s.asOf||"").localeCompare(String(e.asOf||""))||p(e.method)-p(s.method):String(e.partyLabel||"").localeCompare(String(s.partyLabel||""))||String(e.topicLabel||"").localeCompare(String(s.topicLabel||""))||String(s.asOf||"").localeCompare(String(e.asOf||""))||p(e.method)-p(s.method):String(e.scope).localeCompare(String(s.scope))});let h=Math.max(10,Number(j.limit||180));return c.slice(0,h)},[x,y,b,f,j]),N=(0,t.useMemo)(()=>{if(!v||"person"!==v.scope)return null;let e=b.get(v.personId);return e||null},[v,b]),w=(0,t.useMemo)(()=>v&&"party"===v.scope?y.get(v.partyId):null,[v,y]),$=(0,t.useMemo)(()=>v?["person"===v.scope?`Persona: ${v.personName||v.personId}`:`Partido: ${v.partyLabel||v.partyId}`,`Tema: ${v.topicLabel||v.topicId}`,`M\xe9todo: ${v.method||"—"}`,`As of: ${v.asOf||"—"}`].join(" · "):"Sin selección",[v]);return e?(0,s.jsx)("main",{className:"shell",children:(0,s.jsx)("section",{className:"card block",children:(0,s.jsx)("p",{className:"sub",children:"Cargando posturas trazables…"})})}):u||!x?(0,s.jsx)("main",{className:"shell",children:(0,s.jsxs)("section",{className:"card block",children:[(0,s.jsx)("h2",{children:"Error de publicación"}),(0,s.jsxs)("p",{className:"sub",children:["No pude cargar ",(0,s.jsx)("code",{children:"political-positions/data/stances.json"}),"."]}),(0,s.jsxs)("p",{className:"sub",children:["Error: ",u||"sin datos"]}),(0,s.jsxs)("p",{className:"sub",children:["Genera el snapshot con: ",(0,s.jsx)("code",{children:"python3 scripts/export_political_positions_snapshot.py --db etl/data/staging/politicos-es.db --snapshot-date 2026-02-12"}),"."]})]})}):(0,s.jsxs)("main",{className:"shell",children:[(0,s.jsxs)("section",{className:"hero card",children:[(0,s.jsx)("p",{className:"eyebrow",children:"Postura política explicable"}),(0,s.jsx)("h1",{children:"Topic stance scoring (por persona y partido)"}),(0,s.jsx)("p",{className:"sub",children:"Vistas explicables de posición por tema con evidencia rastreable y estado de revisión para auditoría."}),(0,s.jsxs)("div",{className:"chips",style:{marginTop:12},children:[(0,s.jsxs)("span",{className:"chip",children:["Snapshot: ",x.meta?.snapshot_date||"—"]}),(0,s.jsxs)("span",{className:"chip",children:["Personas: ",r((x.persons||[]).length)]}),(0,s.jsxs)("span",{className:"chip",children:["Partidos: ",r((x.parties||[]).length)]}),(0,s.jsxs)("span",{className:"chip",children:["Topics: ",r((x.topics||[]).length)]}),(0,s.jsxs)("span",{className:"chip",children:["Pendientes de revisión: ",r(x.meta?.review_pending||0)]})]})]}),(0,s.jsxs)("section",{className:"card block",children:[(0,s.jsxs)("div",{className:"filterGrid",children:[(0,s.jsxs)("label",{className:"field",children:["Vista",(0,s.jsxs)("select",{value:j.mode,onChange:e=>g(s=>({...s,mode:e.target.value})),children:[(0,s.jsx)("option",{value:"person",children:"Personas"}),(0,s.jsx)("option",{value:"party",children:"Partidos"})]})]}),(0,s.jsxs)("label",{className:"field",children:["Buscar",(0,s.jsx)("input",{className:"textInput",type:"search",value:j.q,placeholder:"Persona, partido, tema, método",onChange:e=>g(s=>({...s,q:e.target.value}))})]}),(0,s.jsxs)("label",{className:"field",children:["Método",(0,s.jsxs)("select",{value:j.method,onChange:e=>g(s=>({...s,method:e.target.value})),children:[(0,s.jsx)("option",{value:"all",children:"Todos"}),(0,s.jsx)("option",{value:"combined",children:"Combined"}),(0,s.jsx)("option",{value:"votes",children:"Votos"}),(0,s.jsx)("option",{value:"declared",children:"Declarado"})]})]}),(0,s.jsxs)("label",{className:"field",children:["Postura",(0,s.jsxs)("select",{value:j.stance,onChange:e=>g(s=>({...s,stance:e.target.value})),children:[(0,s.jsx)("option",{value:"all",children:"Todas"}),(0,s.jsx)("option",{value:"support",children:"Support"}),(0,s.jsx)("option",{value:"oppose",children:"Oppose"}),(0,s.jsx)("option",{value:"mixed",children:"Mixto"}),(0,s.jsx)("option",{value:"unclear",children:"Poco claro"}),(0,s.jsx)("option",{value:"no_signal",children:"Sin señal"})]})]}),(0,s.jsxs)("label",{className:"field",children:["Tema",(0,s.jsx)("input",{className:"textInput",value:j.topic,placeholder:"Buscar por tema (texto o clave)",onChange:e=>g(s=>({...s,topic:e.target.value}))})]}),(0,s.jsxs)("label",{className:"field",children:["Partido",(0,s.jsx)("input",{className:"textInput",value:j.party,placeholder:"Filtrar por partido",onChange:e=>g(s=>({...s,party:e.target.value}))})]}),(0,s.jsxs)("label",{className:"field",children:["Ordenar",(0,s.jsxs)("select",{value:j.sort,onChange:e=>g(s=>({...s,sort:e.target.value})),children:[(0,s.jsx)("option",{value:"person",children:"Persona/Partido + Tema"}),(0,s.jsx)("option",{value:"topic",children:"Tema"}),(0,s.jsx)("option",{value:"party",children:"Partido"}),(0,s.jsx)("option",{value:"as_of",children:"Fecha (más reciente)"}),(0,s.jsx)("option",{value:"confidence_desc",children:"Confianza (alta)"}),(0,s.jsx)("option",{value:"confidence_asc",children:"Confianza (baja)"}),(0,s.jsx)("option",{value:"method",children:"Método"}),(0,s.jsx)("option",{value:"stance",children:"Postura"})]})]}),(0,s.jsxs)("label",{className:"field",children:["Límite filas",(0,s.jsxs)("select",{value:String(j.limit||180),onChange:e=>g(s=>({...s,limit:Number(e.target.value)||180})),children:[(0,s.jsx)("option",{value:120,children:"120"}),(0,s.jsx)("option",{value:180,children:"180"}),(0,s.jsx)("option",{value:240,children:"240"}),(0,s.jsx)("option",{value:320,children:"320"}),(0,s.jsx)("option",{value:400,children:"400"})]})]})]}),(0,s.jsxs)("div",{className:"chips",style:{marginTop:10},children:[(0,s.jsxs)("span",{className:"chip",children:["Filas mostradas: ",S.length]}),(0,s.jsxs)("span",{className:"chip",children:["Filas calculadas: ",S.length]}),"person"===j.mode?(0,s.jsx)("span",{className:"chip",children:"Modo: comparación persona · tema · método"}):(0,s.jsx)("span",{className:"chip",children:"Modo: agregación por grupo parlamentario"})]})]}),(0,s.jsxs)("section",{className:"card block",children:[(0,s.jsxs)("div",{className:"blockHead",children:[(0,s.jsx)("h2",{children:"Trayectorias y evidencia"}),(0,s.jsx)("p",{className:"sub",children:"Selecciona una fila para ver muestra de evidencia + estado de revisión."})]}),(0,s.jsx)("div",{className:"tableWrap",children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Ámbito"}),(0,s.jsx)("th",{children:"Entidad"}),(0,s.jsx)("th",{children:"Tema"}),(0,s.jsx)("th",{children:"Método"}),(0,s.jsx)("th",{children:"As Of"}),(0,s.jsx)("th",{children:"Postura"}),(0,s.jsx)("th",{children:"Score"}),(0,s.jsx)("th",{children:"Confianza"}),(0,s.jsx)("th",{children:"Evidencia"}),(0,s.jsx)("th",{children:"Revisión"})]})}),(0,s.jsxs)("tbody",{children:[S.map(e=>{let t=v?.key===e.key,a="person"===e.scope?`${e.personName||e.personId} \xb7 ${e.partyLabel||"Sin partido"}`:`${e.partyLabel||e.partyId}`,i=`/${e.scope}/`;return(0,s.jsxs)("tr",{className:t?"rowSelected":"",onClick:()=>_(e),role:"button",tabIndex:0,onKeyDown:s=>{("Enter"===s.key||" "===s.key)&&_(e)},style:{cursor:"pointer"},children:[(0,s.jsx)("td",{children:i}),(0,s.jsx)("td",{children:a}),(0,s.jsx)("td",{children:e.topicLabel||"Sin tema"}),(0,s.jsx)("td",{children:e.method||"—"}),(0,s.jsxs)("td",{children:[c(e.asOf),e.windowDays?` (${e.windowDays}d)`:""]}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:`pill ${d(e.stance)}`,children:e.stance||"no_signal"})}),(0,s.jsx)("td",{children:o(e.score)}),(0,s.jsx)("td",{children:n(e.confidence)}),(0,s.jsx)("td",{children:function(e){let s=e?.evidence_breakdown||{},t=r(e?.evidence_count||0);if(!t)return"Sin evidencia agregada";let a=[];return r(s.declared)&&a.push(`declarada:${r(s.declared)}`),r(s.revealed)&&a.push(`votos:${r(s.revealed)}`),r(s.other)&&a.push(`otra:${r(s.other)}`),a.length?a.join(" · "):`Total ${t}`}(e)}),(0,s.jsx)("td",{children:m(e)})]},e.key)}),!S.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:9,className:"sub",children:"No hay datos para los filtros actuales."})})]})]})})]}),(0,s.jsxs)("section",{className:"card block",children:[(0,s.jsxs)("div",{className:"blockHead",children:[(0,s.jsx)("h2",{children:"Detalle de evidencia"}),(0,s.jsx)("p",{className:"sub",children:$})]}),v?(0,s.jsxs)("div",{className:"twoCols",style:{marginTop:12},children:[(0,s.jsxs)("article",{className:"kpiCard",children:[(0,s.jsx)("span",{className:"kpiLabel",children:"Entidad activa"}),(0,s.jsx)("p",{className:"sub",children:"person"===v.scope?N?`${N.full_name||"Persona"} (ID ${N.person_id||v.personId})`:"Persona":w?`${w.name||w.acronym||"Partido"} (ID ${v.partyId})`:"Partido"}),(0,s.jsxs)("p",{className:"sub",children:["Tema: ",v.topicLabel||`#${v.topicId}`]}),(0,s.jsxs)("p",{className:"sub",children:["Postura: ",(0,s.jsx)("span",{className:`pill ${d(v.stance)}`,children:v.stance||"no_signal"})]}),(0,s.jsxs)("p",{className:"sub",children:["Score: ",o(v.score)," · Confianza: ",n(v.confidence)]}),(0,s.jsxs)("p",{className:"sub",children:["Evidencias: ",v.evidenceCount||0]}),(0,s.jsxs)("p",{className:"sub",children:["Última evidencia: ",c(v.lastEvidenceDate||"")]})]}),(0,s.jsxs)("article",{className:"kpiCard",children:[(0,s.jsx)("span",{className:"kpiLabel",children:"Links de exploración"}),(0,s.jsx)("p",{className:"sub",style:{marginBottom:4},children:"person"===v.scope?(0,s.jsx)("a",{href:`${a()}/explorer/?t=topic_evidence&wc=person_id&wv=${v.personId}&wc=topic_id&wv=${v.topicId}&wc=topic_set_id&wv=${x.meta?.topic_set_id||1}`,children:"Explorer: evidencia tema"}):(0,s.jsx)("a",{href:`${a()}/explorer/?t=topic_positions&wc=party_id&wv=${v.partyId}&wc=topic_id&wv=${v.topicId}&wc=topic_set_id&wv=${x.meta?.topic_set_id||1}`,children:"Explorer: posiciones de grupo"})}),(0,s.jsx)("p",{className:"sub",children:"person"===v.scope?(0,s.jsx)("a",{href:`${a()}/explorer/?t=parl_vote_member_votes&wc=person_id&wv=${v.personId}&wc=topic_id&wv=${v.topicId}`,children:"Explorer: votos persona"}):(0,s.jsx)("a",{href:`${a()}/explorer/?t=topic_positions&wc=party_id&wv=${v.partyId}&wc=topic_set_id&wv=${x.meta?.topic_set_id||1}`,children:"Explorer: partido y tema"})}),(0,s.jsxs)("p",{className:"sub",children:["Revisión: ",m(v)]})]})]}):(0,s.jsx)("p",{className:"sub",children:"Selecciona una fila para mostrar las evidencias puntuales y su estado de revisión."}),v?(0,s.jsx)("div",{className:"tableWrap",style:{marginTop:12},children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Fuente"}),(0,s.jsx)("th",{children:"Fecha"}),(0,s.jsx)("th",{children:"Tipo"}),(0,s.jsx)("th",{children:"Postura"}),(0,s.jsx)("th",{children:"Confianza"}),(0,s.jsx)("th",{children:"Extracto"}),(0,s.jsx)("th",{children:"Revisión"})]})}),(0,s.jsxs)("tbody",{children:[(v.samples||[]).slice(0,6).map(e=>{let t=String(e.source_url||"");return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:t?(0,s.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",children:e.source_id||"fuente"}):e.source_id||"—"}),(0,s.jsx)("td",{children:c(e.evidence_date||"")}),(0,s.jsx)("td",{children:e.evidence_type||"—"}),(0,s.jsx)("td",{children:e.stance||"—"}),(0,s.jsx)("td",{children:n(e.confidence||0)}),(0,s.jsx)("td",{children:String(e.excerpt||e.title||"—").slice(0,280)}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"sub",children:e.review&&e.review.status?e.review.status:"sin revisión"})})]},`${e.source_id||"src"}-${e.evidence_id||e.evidence_record_id||""}-${e.evidence_type||""}`)}),v.samples&&v.samples.length?null:(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"sub",children:"Esta postura no tiene evidencia puntual listada para su rastro."})})]})]})}):null]})]})}e.s(["default",()=>u])}]);