# E2E Scrape/Load Tracker

Objetivo: **una sola lista** de trabajo operativo para completar el extremo a extremo (extract -> transform -> load -> publish) por tipo de dato.

Reglas:
- Marcar `DONE` solo con evidencia (comando/SQL/snapshot) y `records_loaded > 0` en red real (cuando aplique).
- No duplicar este backlog en otros docs (para planificación: `docs/roadmap.md` y `docs/roadmap-tecnico.md`).

Atajos:
- Estado (SQL vs tracker): `just etl-tracker-status`
- Gate default estricto (usa `docs/etl/mismatch-waivers.json`; falla por `mismatch` no waived, waiver `expired`, o `DONE` sin red real): `just etl-tracker-gate`
- Gate legacy (compatibilidad histórica; ignora política de mismatches y solo valida `DONE` sin red real): `just etl-tracker-gate-legacy`

## Definition of Done (por fila)

- Fuente oficial documentada (`source_url`) y contrato real (formatos/IDs).
- Ingesta reproducible (ideal: `--strict-network`; fallback `--from-file` solo si está documentado y con muestras).
- Normalización a esquema canónico con PKs/FKs navegables en Explorer cuando aplique.
- Carga idempotente (upsert) con `source_record_id` estable.
- Validaciones mínimas (incluye `PRAGMA foreign_key_check` sin filas).
- Artefacto publicado o endpoint/UI consumible (según tipo de dato).

## Tracker por tipo de dato

Leyenda:
- `DONE`: listo E2E.
- `PARTIAL`: hay piezas, falta DoD/quality/publish.
- `TODO`: no implementado.

| Tipo de dato | Dominio | Fuentes objetivo | Estado | Bloque principal |
|---|---|---|---|---|
| Representantes y mandatos (Congreso) | Nacional | Congreso OpenData Diputados | DONE | Mejorar calidad de campos opcionales |
| Representantes y mandatos (Cortes de Aragon) | Autonomico | Cortes de Aragon: diputados (XI) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Senado) | Nacional | Senado OpenData XML (grupos + fichas) | DONE | Hardening de aliases y umbral minimo |
| Representantes y mandatos (Europarl) | Europeo | Europarl MEP XML | DONE | Mejorar completitud de fechas/metadatos |
| Representantes y cargos locales | Municipal | RED SARA Concejales | DONE | Definir umbral minimo y criterio de cobertura |
| Representantes y mandatos (Asamblea de Madrid) | Autonomico | Asamblea de Madrid OpenData Ocupaciones | DONE | Definir umbral minimo y aclarar semantica de `is_active` |
| Representantes y mandatos (Asamblea de Ceuta) | Autonomico | Asamblea de Ceuta: miembros (2023/2027) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea de Melilla) | Autonomico | Asamblea de Melilla: diputados (2023/2027) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea de Extremadura) | Autonomico | Asamblea de Extremadura (dipslegis + paginacion) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea Murcia) | Autonomico | Asamblea Regional de Murcia: diputados (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (JGPA Asturias) | Autonomico | Junta General del Principado de Asturias (diputados) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Canarias) | Autonomico | Parlamento de Canarias: diputados + grupos (API oficial) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Cantabria) | Autonomico | Parlamento de Cantabria | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Galicia) | Autonomico | Parlamento de Galicia: deputados (fichas HTML) | PARTIAL | Done now: NO. Blocker: `parlamento_galicia_deputados` en `strict-network` sigue bloqueado con HTTP 403 (`run_id=265`, `run_records_loaded=0`), por lo que la fila permanece `PARTIAL`. Evidencia: `docs/etl/sprints/AI-OPS-14/evidence/blocker-probe-refresh.log`, `docs/etl/sprints/AI-OPS-14/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-14/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source parlamento_galicia_deputados --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Representantes y mandatos (Parlament IB) | Autonomico | Parlament de les Illes Balears: diputats (listado + fichas via webGTP) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de La Rioja) | Autonomico | Parlamento de La Rioja: diputados (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlament de Catalunya) | Autonomico | Parlament de Catalunya (composicio actual + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Corts Valencianes) | Autonomico | Corts Valencianes (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Cortes CLM) | Autonomico | Cortes de Castilla-La Mancha (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Cortes CyL) | Autonomico | Cortes de Castilla y Leon (PlenoAlfabetico) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Andalucia) | Autonomico | Parlamento de Andalucia (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Navarra) | Autonomico | Parlamento de Navarra: parlamentarios forales (fichas HTML) | PARTIAL | Done now: NO. Blocker: `parlamento_navarra_parlamentarios_forales` en `strict-network` sigue bloqueado con HTTP 403 (`run_id=266`, `run_records_loaded=0`), por lo que la fila permanece `PARTIAL`. Evidencia: `docs/etl/sprints/AI-OPS-14/evidence/blocker-probe-refresh.log`, `docs/etl/sprints/AI-OPS-14/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-14/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source parlamento_navarra_parlamentarios_forales --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Representantes y mandatos (Parlamento Vasco) | Autonomico | Parlamento Vasco (listado ACT) | DONE | Hardening de parsing y umbral minimo |
| Normativa autonómica (piloto 3 CCAA) | Legal | BOCM (Madrid) + DOGC (Catalunya) + BOJA (Andalucía) | TODO | Falta conector y modelo canónico de normas autonómicas (con efectos) con trazabilidad y dedupe por versión |
| Contratación autonómica (piloto 3 CCAA) | Dinero | PLACSP (filtrado por órganos autonómicos) | DONE | Done now: YES. `placsp_autonomico` recuperó `strict-network` con red real (`run_id=248`, `run_status=ok`, `run_records_loaded=106`) y el mismatch restante era solo desfase tracker/SQL, por lo que se reconcilia la fila a `DONE` sin waiver. Evidencia: `docs/etl/sprints/AI-OPS-11/evidence/placsp-strict-refresh.log`, `docs/etl/sprints/AI-OPS-11/evidence/post-strict-status.log`, `docs/etl/sprints/AI-OPS-11/evidence/post-strict-gate.log`, `docs/etl/sprints/AI-OPS-11/exports/placsp_waiver_decision.csv`. Siguiente comando: `just etl-tracker-gate`. |
| Subvenciones autonómicas (piloto 3 CCAA) | Dinero | BDNS/SNPSAP (filtrado por órgano convocante/territorio) | DONE | Done now: YES. `bdns_autonomico` recuperó `strict-network` con endpoint JSON (`/bdnstrans/api/convocatorias/busqueda`) y red real (`run_id=257`, `run_status=ok`, `run_records_loaded=50`), por lo que se reconcilia la fila a `DONE` sin waiver. Evidencia: `docs/etl/sprints/AI-OPS-13/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-13/evidence/bdns-api-discovery.log`, `docs/etl/sprints/AI-OPS-13/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `just etl-tracker-gate`. |
| Presupuesto + ejecución autonómica (piloto 3 CCAA) | Dinero | Portales presupuestarios autonómicos / IGAE cuando aplique | TODO | Falta conector y crosswalk de clasificaciones; preferir ejecución cuando exista |
| Procesos electorales y resultados | Electoral | Infoelectoral descargas/procesos | DONE | Hardening de parsing de campos opcionales en procesos/resultados |
| Publicacion abierta de snapshots ETL | Operaciones | Hugging Face Datasets (dataset publico) | DONE | Done now: YES. Snapshot público reproducible disponible en HF con paquete por fecha (`snapshots/<snapshot_date>/`) que incluye `published/*`, `manifest.json`, `checksums.sha256`, `latest.json` y Parquet navegable; por privacidad se excluyen por defecto `raw_fetches,run_fetches,source_records,lost_and_found` y `politicos-es.sqlite.gz` queda desactivado salvo override explícito. Comando: `just etl-publish-hf` (dry-run: `just etl-publish-hf-dry-run`). Siguiente comando: `SNAPSHOT_DATE=2026-02-12 just etl-publish-hf`. |
| Convocatorias y estado electoral | Electoral | Junta Electoral Central | TODO | Falta scraper y normalizacion |
| Marco legal electoral | Legal | BOE API | DONE | Done now: YES. Ingesta BOE (`boe_api_legal`) y mapping a `policy_events` están reproducibles (`records_loaded=298`, `policy_events_boe=298`) y reconciliados con SQL `DONE`. Evidencia: `docs/etl/sprints/AI-OPS-08/reports/waiver-burndown-apply-recompute.md`, `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-boe-ingest-replay.log`, `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-boe-policy-events-backfill.log` y `docs/etl/sprints/AI-OPS-08/reports/boe-tracker-mapping-hardening.md`. Siguiente comando: `just etl-tracker-gate`. |
| Accion ejecutiva (Consejo de Ministros) | Ejecutivo | La Moncloa: referencias + RSS | DONE | Done now: YES. Ingesta Moncloa y mapping a `policy_events` reproducibles (`moncloa_referencias=20`, `moncloa_rss_referencias=8`, total `28`) y reconciliadas con SQL `DONE` sin waiver activa para Moncloa. Evidencia: `docs/etl/sprints/AI-OPS-07/reports/dual-entry-apply-recompute.md`, `docs/etl/sprints/AI-OPS-07/reports/boe-policy-events-mapping.md` y `docs/etl/sprints/AI-OPS-07/evidence/post_apply_waiveraware_checker_final.log`. Siguiente comando: `just etl-tracker-gate`. |
| Contratacion publica (Espana) | Dinero | PLACSP: sindicación/ATOM (CODICE) | DONE | Done now: YES. `placsp_sindicacion` recuperó `strict-network` con red real (`run_id=249`, `run_status=ok`, `run_records_loaded=106`) y el mismatch restante era solo desfase tracker/SQL, por lo que se reconcilia la fila a `DONE` sin waiver. Evidencia: `docs/etl/sprints/AI-OPS-11/evidence/placsp-strict-refresh.log`, `docs/etl/sprints/AI-OPS-11/evidence/post-strict-status.log`, `docs/etl/sprints/AI-OPS-11/evidence/post-strict-gate.log`, `docs/etl/sprints/AI-OPS-11/exports/placsp_waiver_decision.csv`. Siguiente comando: `just etl-tracker-gate`. |
| Subvenciones y ayudas (Espana) | Dinero | BDNS/SNPSAP: API | DONE | Done now: YES. `bdns_api_subvenciones` recuperó `strict-network` con endpoint JSON (`/bdnstrans/api/convocatorias/ultimas`) y red real (`run_id=256`, `run_status=ok`, `run_records_loaded=50`), por lo que se reconcilia la fila a `DONE` sin waiver. Evidencia: `docs/etl/sprints/AI-OPS-13/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-13/evidence/bdns-api-discovery.log`, `docs/etl/sprints/AI-OPS-13/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `just etl-tracker-gate`. |
| Indicadores (outcomes): Eurostat | Outcomes | Eurostat (API/SDMX) | DONE | Done now: YES. `eurostat_sdmx` tiene `strict-network` exitoso (`run_records_loaded=2394`) y replay no-cero (`run_records_loaded=2`), por lo que el mismatch actual era desfase tracker/SQL y se reconcilia a `DONE`. Evidencia: `docs/etl/sprints/AI-OPS-10/evidence/eurostat-sql/eurostat_sdmx__strict-network_run_snapshot.csv`, `docs/etl/sprints/AI-OPS-10/evidence/eurostat-sql/eurostat_sdmx__replay_run_snapshot.csv`, `docs/etl/sprints/AI-OPS-10/reports/eurostat-apply.md`, `docs/etl/sprints/AI-OPS-10/evidence/tracker-gate-postrun.log`, `docs/etl/sprints/AI-OPS-10/evidence/status-postrun.json`. Siguiente comando: `just etl-tracker-gate`. |
| Indicadores (confusores): Banco de Espana | Outcomes | Banco de Espana (API series) | PARTIAL | Done now: NO. Blocker: `bde_series_api` en `strict-network` sigue fallando por DNS (`Errno 8`, `run_id=264`, `run_records_loaded=0`), por lo que la fila permanece `PARTIAL`. Evidencia: `docs/etl/sprints/AI-OPS-14/evidence/blocker-probe-refresh.log`, `docs/etl/sprints/AI-OPS-14/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-14/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source bde_series_api --url https://api.bde.es/datos/series/PARO.TASA.ES.M --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (confusores): AEMET | Outcomes | AEMET OpenData | PARTIAL | Done now: NO. Blocker: `aemet_opendata_series` en `strict-network` sigue bloqueado por contrato (`aemet_blocker=contract`, JSON invalido con payload vacío `payload_sig=e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855`, `run_id=263`, `run_records_loaded=0`), por lo que la fila permanece `PARTIAL`. Evidencia: `docs/etl/sprints/AI-OPS-14/evidence/blocker-probe-refresh.log`, `docs/etl/sprints/AI-OPS-14/evidence/unblock-execution.log`, `docs/etl/sprints/AI-OPS-14/exports/unblock_feasibility_matrix.csv`. Siguiente comando: `AEMET_API_KEY=<token> python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source aemet_opendata_series --url https://opendata.aemet.es/opendata/api/observacion/convencional/todas --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (confusores): ESIOS/REE | Outcomes | ESIOS/REE API (token) | TODO | Falta conector; gestión de token/cuotas; almacenamiento eficiente para series horarias |
| UE: legislacion y documentos | UE | EUR-Lex / Cellar (SPARQL/REST) | TODO | Falta conector UE legal; linking a expedientes y textos vigentes |
| UE: votaciones (roll-call) | UE | Parlamento Europeo: votes XML/PDF + Open Data Portal | TODO | Falta ingesta de votos + mapeo a MEPs; KPI: % con actor resuelto |
| UE: contratacion publica | UE | TED API (notices) | TODO | Falta ingesta; KPI: cobertura y trazabilidad por notice |
| UE: lobbying/influencia | UE | EU Transparency Register | TODO | Falta ingesta y modelo de entidades; linking cuando existan meetings/agendas publicas |
| Posiciones declaradas (programas) | Editorial | Webs/programas de partidos | PARTIAL | Done now: YES (MVP reproducible). Nuevo source `programas_partidos` (manifest-driven) ingesta `source_records` + `text_documents` + `topic_evidence` (`declared:programa`) con topics basados en `ui/citizen/concerns_v1.json` (topic_set por `election_cycle`). Stance auto: `support=4`, `oppose=1`, `review_pending=6` (sample); posiciones declaradas: `positions_total=5` (`topic_set_id=11`, `as_of_date=2026-02-17`). Evidencia: `docs/etl/sprints/AI-OPS-18/reports/programas-pipeline-design.md`, `docs/etl/sprints/AI-OPS-18/evidence/programas_declared_stance_post.json`, `docs/etl/sprints/AI-OPS-18/evidence/programas_declared_positions_post.json`, `docs/etl/sprints/AI-OPS-18/exports/programas_kpi_post.csv`. Siguiente comando: `python3 scripts/ingestar_parlamentario_es.py ingest --db <db> --source programas_partidos --from-file <manifest.csv> --snapshot-date <YYYY-MM-DD>` + `python3 scripts/ingestar_parlamentario_es.py backfill-declared-stance --db <db> --source-id programas_partidos` + `python3 scripts/ingestar_parlamentario_es.py backfill-declared-positions --db <db> --source-id programas_partidos --as-of-date <YYYY-MM-DD>`. |
| Taxonomia de temas (alto impacto por scope) | Analitica | Definicion de temas + stake scoring por institucion/territorio/mandato | DONE | Seed/versionado: `etl/data/seeds/topic_taxonomy_es.json`. Build: `python3 scripts/ingestar_parlamentario_es.py backfill-topic-analytics --db <db> --as-of-date <YYYY-MM-DD> --taxonomy-seed etl/data/seeds/topic_taxonomy_es.json` |
| Evidencia textual (para posiciones declaradas) | Analitica | Diarios de sesiones, intervenciones, preguntas, notas oficiales | DONE | Modelo canónico: `text_documents` (metadata + excerpt) enlazado por `source_record_pk` de `topic_evidence`. Backfill: `python3 scripts/ingestar_parlamentario_es.py backfill-text-documents --db <db> --source-id congreso_intervenciones --only-missing` (o `just parl-backfill-text-documents`). Además, copia un snippet a `topic_evidence.excerpt` para que `/explorer-temas` sea auditable sin joins. Nota: stance classification sigue siendo otro paso (ver filas de “Intervenciones”/“Posiciones”). |
| Clasificacion evidencia -> tema (trazable) | Analitica | Reglas deterministas + señales ML opcionales (siempre auditables) | DONE | MVP (votos + intervenciones): evidencia se etiqueta a `topic_id` (votos via `parl_vote_event_initiatives`; intervenciones via `initiative_id`/expediente). KPIs en `/explorer-sources`: `topic_evidence_with_topic_pct` + breakdown por `topic_method`/`stance_method`. |
| Posiciones por tema (politico x scope) | Analitica | Agregacion reproducible + drill-down a evidencia | DONE | Done now: YES. `backfill-topic-analytics` en `as_of_date=2026-02-16` dejó ambos sets en latest alineado y cerró el blocker de cobertura en Congreso: `topic_set_id=1` pasó de `12/60 (20.0%)` a `60/60 (100.0%)`, mientras `topic_set_id=2` quedó en `23/24 (95.83%)` con latest también en `2026-02-16`; además, `topic_positions_total` subió de `137379` a `205907` y `computed_method_votes` de `68528` a `137056` (`combined=68612`, `declared=239`). Evidencia: `docs/etl/sprints/AI-OPS-15/exports/topic_positions_kpi_baseline.csv`, `docs/etl/sprints/AI-OPS-15/exports/topic_positions_kpi_post.csv`, `docs/etl/sprints/AI-OPS-15/evidence/topic_positions_baseline.log`, `docs/etl/sprints/AI-OPS-15/evidence/topic_positions_recompute.log`, `docs/etl/sprints/AI-OPS-15/reports/topic_positions_reconciliation.md`. Siguiente comando: `just etl-tracker-gate`. |
