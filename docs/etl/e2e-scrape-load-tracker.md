# E2E Scrape/Load Tracker

Objetivo: **una sola lista** de trabajo operativo para completar el extremo a extremo (extract -> transform -> load -> publish) por tipo de dato.

Reglas:
- Marcar `DONE` solo con evidencia (comando/SQL/snapshot) y `records_loaded > 0` en red real (cuando aplique).
- No duplicar este backlog en otros docs (para planificación: `docs/roadmap.md` y `docs/roadmap-tecnico.md`).

Atajos:
- Estado (SQL vs tracker): `just etl-tracker-status`
- Gate default estricto (usa `docs/etl/mismatch-waivers.json`; falla por `mismatch` no waived, waiver `expired`, o `DONE` sin red real): `just etl-tracker-gate`
- Gate legacy (compatibilidad histórica; ignora política de mismatches y solo valida `DONE` sin red real): `just etl-tracker-gate-legacy`

## Definition of Done (por fila)

- Fuente oficial documentada (`source_url`) y contrato real (formatos/IDs).
- Ingesta reproducible (ideal: `--strict-network`; fallback `--from-file` solo si está documentado y con muestras).
- Normalización a esquema canónico con PKs/FKs navegables en Explorer cuando aplique.
- Carga idempotente (upsert) con `source_record_id` estable.
- Validaciones mínimas (incluye `PRAGMA foreign_key_check` sin filas).
- Artefacto publicado o endpoint/UI consumible (según tipo de dato).

## Tracker por tipo de dato

Leyenda:
- `DONE`: listo E2E.
- `PARTIAL`: hay piezas, falta DoD/quality/publish.
- `TODO`: no implementado.

| Tipo de dato | Dominio | Fuentes objetivo | Estado | Bloque principal |
|---|---|---|---|---|
| Representantes y mandatos (Congreso) | Nacional | Congreso OpenData Diputados | DONE | Mejorar calidad de campos opcionales |
| Representantes y mandatos (Cortes de Aragon) | Autonomico | Cortes de Aragon: diputados (XI) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Senado) | Nacional | Senado OpenData XML (grupos + fichas) | DONE | Hardening de aliases y umbral minimo |
| Representantes y mandatos (Europarl) | Europeo | Europarl MEP XML | DONE | Mejorar completitud de fechas/metadatos |
| Representantes y cargos locales | Municipal | RED SARA Concejales | DONE | Definir umbral minimo y criterio de cobertura |
| Representantes y mandatos (Asamblea de Madrid) | Autonomico | Asamblea de Madrid OpenData Ocupaciones | DONE | Definir umbral minimo y aclarar semantica de `is_active` |
| Representantes y mandatos (Asamblea de Ceuta) | Autonomico | Asamblea de Ceuta: miembros (2023/2027) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea de Melilla) | Autonomico | Asamblea de Melilla: diputados (2023/2027) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea de Extremadura) | Autonomico | Asamblea de Extremadura (dipslegis + paginacion) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Asamblea Murcia) | Autonomico | Asamblea Regional de Murcia: diputados (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (JGPA Asturias) | Autonomico | Junta General del Principado de Asturias (diputados) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Canarias) | Autonomico | Parlamento de Canarias: diputados + grupos (API oficial) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Cantabria) | Autonomico | Parlamento de Cantabria | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Galicia) | Autonomico | Parlamento de Galicia: deputados (fichas HTML) | PARTIAL | Done now: NO. Blocker: `--strict-network` en `parlamento_galicia_deputados` sigue bloqueado con HTTP 403 en este entorno, sin cierre de estado operativo. Evidencia: `docs/etl/sprints/AI-OPS-08/reports/waiver-burndown-apply-recompute.md` y `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-probe-galicia-strict.log`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source parlamento_galicia_deputados --snapshot-date 2026-02-16 --strict-network --timeout 30`. |
| Representantes y mandatos (Parlament IB) | Autonomico | Parlament de les Illes Balears: diputats (listado + fichas via webGTP) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de La Rioja) | Autonomico | Parlamento de La Rioja: diputados (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlament de Catalunya) | Autonomico | Parlament de Catalunya (composicio actual + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Corts Valencianes) | Autonomico | Corts Valencianes (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Cortes CLM) | Autonomico | Cortes de Castilla-La Mancha (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Cortes CyL) | Autonomico | Cortes de Castilla y Leon (PlenoAlfabetico) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Andalucia) | Autonomico | Parlamento de Andalucia (listado + fichas) | DONE | Hardening de parsing y umbral minimo |
| Representantes y mandatos (Parlamento de Navarra) | Autonomico | Parlamento de Navarra: parlamentarios forales (fichas HTML) | PARTIAL | Done now: NO. Blocker: `--strict-network` en `parlamento_navarra_parlamentarios_forales` sigue bloqueado con HTTP 403; la fila permanece `PARTIAL` con carga SQL `PARTIAL` (sin mismatch activo). Evidencia: `docs/etl/sprints/AI-OPS-08/reports/waiver-burndown-apply-recompute.md` y `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-probe-navarra-strict.log`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source parlamento_navarra_parlamentarios_forales --snapshot-date 2026-02-16 --strict-network --timeout 30`. |
| Representantes y mandatos (Parlamento Vasco) | Autonomico | Parlamento Vasco (listado ACT) | DONE | Hardening de parsing y umbral minimo |
| Normativa autonómica (piloto 3 CCAA) | Legal | BOCM (Madrid) + DOGC (Catalunya) + BOJA (Andalucía) | TODO | Falta conector y modelo canónico de normas autonómicas (con efectos) con trazabilidad y dedupe por versión |
| Contratación autonómica (piloto 3 CCAA) | Dinero | PLACSP (filtrado por órganos autonómicos) | PARTIAL | Done now: NO. Bloqueador: mismatch sin waiver por paridad de replay no auditable (`metric,value` sin `run_records_loaded` y replay no determinista en evidencias AI-OPS-09). Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`, `docs/etl/sprints/AI-OPS-09/reports/placsp-apply-recompute.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source placsp_autonomico --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Subvenciones autonómicas (piloto 3 CCAA) | Dinero | BDNS/SNPSAP (filtrado por órgano convocante/territorio) | PARTIAL | Done now: NO. Bloqueador: strict-network bloqueado por payload HTML anti-bot y replay fixture ausente, con mismatch sin waiver. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/bdns-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source bdns_autonomico --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Presupuesto + ejecución autonómica (piloto 3 CCAA) | Dinero | Portales presupuestarios autonómicos / IGAE cuando aplique | TODO | Falta conector y crosswalk de clasificaciones; preferir ejecución cuando exista |
| Procesos electorales y resultados | Electoral | Infoelectoral descargas/procesos | DONE | Hardening de parsing de campos opcionales en procesos/resultados |
| Publicacion abierta de snapshots ETL | Operaciones | Hugging Face Datasets (dataset publico) | DONE | Done now: YES. Snapshot público reproducible disponible en HF con paquete por fecha (`snapshots/<snapshot_date>/`) que incluye `published/*`, `manifest.json`, `checksums.sha256`, `latest.json` y Parquet navegable; por privacidad se excluyen por defecto `raw_fetches,run_fetches,source_records,lost_and_found` y `politicos-es.sqlite.gz` queda desactivado salvo override explícito. Comando: `just etl-publish-hf` (dry-run: `just etl-publish-hf-dry-run`). Siguiente comando: `SNAPSHOT_DATE=2026-02-12 just etl-publish-hf`. |
| Convocatorias y estado electoral | Electoral | Junta Electoral Central | TODO | Falta scraper y normalizacion |
| Marco legal electoral | Legal | BOE API | DONE | Done now: YES. Ingesta BOE (`boe_api_legal`) y mapping a `policy_events` están reproducibles (`records_loaded=298`, `policy_events_boe=298`) y reconciliados con SQL `DONE`. Evidencia: `docs/etl/sprints/AI-OPS-08/reports/waiver-burndown-apply-recompute.md`, `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-boe-ingest-replay.log`, `docs/etl/sprints/AI-OPS-08/evidence/waiver-burndown-apply-recompute-boe-policy-events-backfill.log` y `docs/etl/sprints/AI-OPS-08/reports/boe-tracker-mapping-hardening.md`. Siguiente comando: `just etl-tracker-gate`. |
| Accion ejecutiva (Consejo de Ministros) | Ejecutivo | La Moncloa: referencias + RSS | DONE | Done now: YES. Ingesta Moncloa y mapping a `policy_events` reproducibles (`moncloa_referencias=20`, `moncloa_rss_referencias=8`, total `28`) y reconciliadas con SQL `DONE` sin waiver activa para Moncloa. Evidencia: `docs/etl/sprints/AI-OPS-07/reports/dual-entry-apply-recompute.md`, `docs/etl/sprints/AI-OPS-07/reports/boe-policy-events-mapping.md` y `docs/etl/sprints/AI-OPS-07/evidence/post_apply_waiveraware_checker_final.log`. Siguiente comando: `just etl-tracker-gate`. |
| Contratacion publica (Espana) | Dinero | PLACSP: sindicación/ATOM (CODICE) | PARTIAL | Done now: NO. Bloqueador: `placsp_sindicacion` mantiene mismatch; strict-network reporta timeout intermitente y replay falla con fixture vacío/ParseError, sin paridad cerrada. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/placsp-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source placsp_sindicacion --snapshot-date 2026-02-17 --strict-network --timeout 60`. |
| Subvenciones y ayudas (Espana) | Dinero | BDNS/SNPSAP: API | PARTIAL | Done now: NO. Bloqueador: `bdns_api_subvenciones` sigue con mismatch por anti-HTML en strict-network y replay no reproducible, sin waiver activa. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/bdns-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source bdns_api_subvenciones --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (outcomes): Eurostat | Outcomes | Eurostat (API/SDMX) | PARTIAL | Done now: NO. Bloqueador: `eurostat_sdmx` tiene strict-network exitoso pero replay/from-file con `run_records_loaded=0` (paridad `DRIFT`), por lo que mismatch sigue abierto. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/eurostat-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source eurostat_sdmx --url https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data/une_rt_a --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (confusores): Banco de Espana | Outcomes | Banco de Espana (API series) | PARTIAL | Done now: NO. Bloqueador: `bde_series_api` sin baseline reproducible porque strict-network/replay fallan (DNS/parse de series), manteniendo mismatch. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/bde-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source bde_series_api --url https://api.bde.es/datos/series/PARO.TASA.ES.M --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (confusores): AEMET | Outcomes | AEMET OpenData | PARTIAL | Done now: NO. Bloqueador: `aemet_opendata_series` con errores de endpoint/replay (incluye 404 en strict-network) y sin ventana token/quota reproducible, por eso mismatch persiste. Evidencia: `docs/etl/sprints/AI-OPS-09/reports/throughput-blockers-summary.md`, `docs/etl/sprints/AI-OPS-09/reports/aemet-apply-recompute.md`, `docs/etl/sprints/AI-OPS-09/evidence/tracker-row-reconciliation.md`. Siguiente comando: `python3 scripts/ingestar_politicos_es.py ingest --db etl/data/staging/politicos-es.db --source aemet_opendata_series --url https://opendata.aemet.es/opendata/api/valores/climatologicos --snapshot-date 2026-02-17 --strict-network --timeout 30`. |
| Indicadores (confusores): ESIOS/REE | Outcomes | ESIOS/REE API (token) | TODO | Falta conector; gestión de token/cuotas; almacenamiento eficiente para series horarias |
| UE: legislacion y documentos | UE | EUR-Lex / Cellar (SPARQL/REST) | TODO | Falta conector UE legal; linking a expedientes y textos vigentes |
| UE: votaciones (roll-call) | UE | Parlamento Europeo: votes XML/PDF + Open Data Portal | TODO | Falta ingesta de votos + mapeo a MEPs; KPI: % con actor resuelto |
| UE: contratacion publica | UE | TED API (notices) | TODO | Falta ingesta; KPI: cobertura y trazabilidad por notice |
| UE: lobbying/influencia | UE | EU Transparency Register | TODO | Falta ingesta y modelo de entidades; linking cuando existan meetings/agendas publicas |
| Posiciones declaradas (programas) | Editorial | Webs/programas de partidos | TODO | Falta pipeline semiestructurado + revision humana |
| Taxonomia de temas (alto impacto por scope) | Analitica | Definicion de temas + stake scoring por institucion/territorio/mandato | DONE | Seed/versionado: `etl/data/seeds/topic_taxonomy_es.json`. Build: `python3 scripts/ingestar_parlamentario_es.py backfill-topic-analytics --db <db> --as-of-date <YYYY-MM-DD> --taxonomy-seed etl/data/seeds/topic_taxonomy_es.json` |
| Evidencia textual (para posiciones declaradas) | Analitica | Diarios de sesiones, intervenciones, preguntas, notas oficiales | DONE | Modelo canónico: `text_documents` (metadata + excerpt) enlazado por `source_record_pk` de `topic_evidence`. Backfill: `python3 scripts/ingestar_parlamentario_es.py backfill-text-documents --db <db> --source-id congreso_intervenciones --only-missing` (o `just parl-backfill-text-documents`). Además, copia un snippet a `topic_evidence.excerpt` para que `/explorer-temas` sea auditable sin joins. Nota: stance classification sigue siendo otro paso (ver filas de “Intervenciones”/“Posiciones”). |
| Clasificacion evidencia -> tema (trazable) | Analitica | Reglas deterministas + señales ML opcionales (siempre auditables) | DONE | MVP (votos + intervenciones): evidencia se etiqueta a `topic_id` (votos via `parl_vote_event_initiatives`; intervenciones via `initiative_id`/expediente). KPIs en `/explorer-sources`: `topic_evidence_with_topic_pct` + breakdown por `topic_method`/`stance_method`. |
| Posiciones por tema (politico x scope) | Analitica | Agregacion reproducible + drill-down a evidencia | PARTIAL | Evidencia reproducible en `docs/etl/sprints/AI-OPS-03/evidence/analytics-partials.md` (§1.4) y `docs/etl/sprints/AI-OPS-03/reports/asof-alignment.md`: SQL reporta `topic_positions_total=137379`, `computed_method_combined=68612`, `computed_method_declared=239`, `computed_method_votes=68528`; cobertura high-stakes latest por set `topic_set_id=1: 12/60 (20.0%)`, `topic_set_id=2: 23/24 (95.83%)`; y en corrida alineada AI-OPS-03 `as_of_date=2026-02-12` sin mezcla por método/set. Aporte a roadmap técnico: avance de Fase 2 (coherencia says-vs-does con drill-down). Bloqueador: latest de Congreso sigue anclado en `as_of_date=2026-02-16` con cobertura `20.0%`. Siguiente comando: `python3 scripts/ingestar_parlamentario_es.py backfill-topic-analytics --db etl/data/staging/politicos-es.db --as-of-date 2026-02-16 --taxonomy-seed etl/data/seeds/topic_taxonomy_es.json`. |
