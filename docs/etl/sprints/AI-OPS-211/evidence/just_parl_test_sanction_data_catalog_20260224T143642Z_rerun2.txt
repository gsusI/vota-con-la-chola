python3 -m unittest tests/test_validate_sanction_data_catalog_seed.py tests/test_import_sanction_data_catalog_seed.py tests/test_report_sanction_data_catalog_status.py tests/test_report_sanction_procedural_official_review_status.py tests/test_export_sanction_procedural_official_review_kpi_gap_queue.py tests/test_export_sanction_procedural_official_review_raw_packets_from_kpi_gap_queue.py tests/test_report_sanction_procedural_official_review_raw_packets_progress.py tests/test_export_sanction_procedural_official_review_packet_fix_queue.py tests/test_run_sanction_procedural_official_review_packet_fix_ready_cycle.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window.py tests/test_report_sanction_procedural_official_review_packet_fix_queue_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest_heartbeat_compaction_window_digest.py tests/test_run_sanction_procedural_official_review_ready_packets_cycle.py tests/test_run_sanction_procedural_official_review_raw_packets_cycle.py tests/test_export_sanction_procedural_official_review_apply_from_kpi_gap_queue.py tests/test_run_sanction_procedural_official_review_apply_from_kpi_gap_cycle.py tests/test_apply_sanction_procedural_official_review_metrics.py tests/test_export_sanction_procedural_official_review_apply_template.py tests/test_export_sanction_procedural_official_review_raw_template.py tests/test_export_sanction_procedural_official_review_apply_from_raw_metrics.py tests/test_prepare_sanction_procedural_official_review_apply_input.py tests/test_report_sanction_procedural_official_review_apply_readiness.py tests/test_run_sanction_procedural_official_review_apply_cycle.py tests/test_run_sanction_procedural_official_review_prepare_apply_cycle.py tests/test_run_sanction_procedural_official_review_raw_prepare_apply_cycle.py
...........................................................................................................................
----------------------------------------------------------------------
Ran 123 tests in 7.356s

OK
{
  "generated_at": "2026-02-24T14:40:14+00:00",
  "status": "ok",
  "strict": true,
  "fix_queue_json": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/fix_queue_ok.json",
  "heartbeat_jsonl": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/heartbeat.jsonl",
  "heartbeat": {
    "run_at": "2026-02-24T12:20:17+00:00",
    "heartbeat_id": "2026-02-24T12:20:17+00:00|ok|0|4|4|0||1|1",
    "fix_queue_path": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/fix_queue_ok.json",
    "fix_queue_generated_at": "2026-02-24T12:20:17+00:00",
    "status": "ok",
    "queue_rows_total": 0,
    "packets_expected_total": 4,
    "packets_ready_total": 4,
    "packets_not_ready_total": 0,
    "queue_rows_by_packet_status": {},
    "fix_queue_empty": true,
    "progress_report_not_failed": true,
    "strict_fail_count": 0,
    "strict_fail_reasons": []
  },
  "validation_errors": [],
  "strict_fail_count": 0,
  "strict_fail_reasons": [],
  "history_rows_before": 0,
  "history_rows_after": 1,
  "malformed_history_rows": 0,
  "already_present": false,
  "appended": true,
  "checks": {
    "heartbeat_valid": true,
    "history_append_succeeded": true
  }
}
{
  "generated_at": "2026-02-24T14:40:14+00:00",
  "status": "ok",
  "strict": true,
  "fix_queue_json": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/fix_queue_ok.json",
  "heartbeat_jsonl": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/heartbeat.jsonl",
  "heartbeat": {
    "run_at": "2026-02-24T12:20:17+00:00",
    "heartbeat_id": "2026-02-24T12:20:17+00:00|ok|0|4|4|0||1|1",
    "fix_queue_path": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpjc3dgyjw/fix_queue_ok.json",
    "fix_queue_generated_at": "2026-02-24T12:20:17+00:00",
    "status": "ok",
    "queue_rows_total": 0,
    "packets_expected_total": 4,
    "packets_ready_total": 4,
    "packets_not_ready_total": 0,
    "queue_rows_by_packet_status": {},
    "fix_queue_empty": true,
    "progress_report_not_failed": true,
    "strict_fail_count": 0,
    "strict_fail_reasons": []
  },
  "validation_errors": [],
  "strict_fail_count": 0,
  "strict_fail_reasons": [],
  "history_rows_before": 1,
  "history_rows_after": 1,
  "malformed_history_rows": 0,
  "already_present": true,
  "appended": false,
  "checks": {
    "heartbeat_valid": true,
    "history_append_succeeded": true
  }
}
{
  "generated_at": "2026-02-24T14:40:14+00:00",
  "status": "failed",
  "strict": true,
  "fix_queue_json": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmps7k_btij/fix_queue_failed.json",
  "heartbeat_jsonl": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmps7k_btij/heartbeat.jsonl",
  "heartbeat": {
    "run_at": "2026-02-24T12:30:00+00:00",
    "heartbeat_id": "2026-02-24T12:30:00+00:00|failed|2|4|2|2|invalid_row:2|0|0",
    "fix_queue_path": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmps7k_btij/fix_queue_failed.json",
    "fix_queue_generated_at": "2026-02-24T12:30:00+00:00",
    "status": "failed",
    "queue_rows_total": 2,
    "packets_expected_total": 4,
    "packets_ready_total": 2,
    "packets_not_ready_total": 2,
    "queue_rows_by_packet_status": {
      "invalid_row": 2
    },
    "fix_queue_empty": false,
    "progress_report_not_failed": false,
    "strict_fail_count": 2,
    "strict_fail_reasons": [
      "fix_queue_status_failed",
      "progress_report_failed"
    ]
  },
  "validation_errors": [],
  "strict_fail_count": 2,
  "strict_fail_reasons": [
    "fix_queue_status_failed",
    "progress_report_failed"
  ],
  "history_rows_before": 0,
  "history_rows_after": 1,
  "malformed_history_rows": 0,
  "already_present": false,
  "appended": true,
  "checks": {
    "heartbeat_valid": true,
    "history_append_succeeded": true
  }
}
{
  "generated_at": "2026-02-24T14:40:14+00:00",
  "status": "failed",
  "strict": true,
  "heartbeat_path": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpskfury8g/heartbeat.jsonl",
  "window_last": 3,
  "thresholds": {
    "max_failed": 0,
    "max_failed_rate_pct": 0.0,
    "max_degraded": 0,
    "max_degraded_rate_pct": 0.0,
    "max_nonempty_queue_runs": 0,
    "max_nonempty_queue_rate_pct": 0.0,
    "max_malformed": 0
  },
  "entries_total": 3,
  "entries_in_window": 3,
  "malformed_entries_in_window": 0,
  "status_counts": {
    "ok": 1,
    "degraded": 1,
    "failed": 1
  },
  "failed_in_window": 1,
  "failed_rate_pct": 33.3333,
  "degraded_in_window": 1,
  "degraded_rate_pct": 33.3333,
  "nonempty_queue_runs_in_window": 2,
  "nonempty_queue_rate_pct": 66.6667,
  "first_failed_run_at": "2026-02-24T12:03:00+00:00",
  "last_failed_run_at": "2026-02-24T12:03:00+00:00",
  "first_degraded_run_at": "2026-02-24T12:02:00+00:00",
  "last_degraded_run_at": "2026-02-24T12:02:00+00:00",
  "latest": {
    "line_no": 3,
    "malformed_line": false,
    "run_at": "2026-02-24T12:03:00+00:00",
    "heartbeat_id": "failed|3|1",
    "status": "failed",
    "queue_rows_total": 1
  },
  "checks": {
    "max_failed_ok": false,
    "max_failed_rate_ok": false,
    "max_degraded_ok": false,
    "max_degraded_rate_ok": false,
    "max_nonempty_queue_runs_ok": false,
    "max_nonempty_queue_rate_ok": false,
    "max_malformed_ok": true
  },
  "strict_fail_count": 6,
  "strict_fail_reasons": [
    "max_failed_ok_exceeded",
    "max_failed_rate_ok_exceeded",
    "max_degraded_ok_exceeded",
    "max_degraded_rate_ok_exceeded",
    "max_nonempty_queue_runs_ok_exceeded",
    "max_nonempty_queue_rate_ok_exceeded"
  ]
}
{
  "generated_at": "2026-02-24T14:40:14+00:00",
  "status": "ok",
  "strict": true,
  "heartbeat_path": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpbkr875dh/heartbeat.jsonl",
  "window_last": 3,
  "thresholds": {
    "max_failed": 0,
    "max_failed_rate_pct": 0.0,
    "max_degraded": 0,
    "max_degraded_rate_pct": 0.0,
    "max_nonempty_queue_runs": 0,
    "max_nonempty_queue_rate_pct": 0.0,
    "max_malformed": 0
  },
  "entries_total": 3,
  "entries_in_window": 3,
  "malformed_entries_in_window": 0,
  "status_counts": {
    "ok": 3,
    "degraded": 0,
    "failed": 0
  },
  "failed_in_window": 0,
  "failed_rate_pct": 0.0,
  "degraded_in_window": 0,
  "degraded_rate_pct": 0.0,
  "nonempty_queue_runs_in_window": 0,
  "nonempty_queue_rate_pct": 0.0,
  "first_failed_run_at": "",
  "last_failed_run_at": "",
  "first_degraded_run_at": "",
  "last_degraded_run_at": "",
  "latest": {
    "line_no": 3,
    "malformed_line": false,
    "run_at": "2026-02-24T12:03:00+00:00",
    "heartbeat_id": "ok|3|0",
    "status": "ok",
    "queue_rows_total": 0
  },
  "checks": {
    "max_failed_ok": true,
    "max_failed_rate_ok": true,
    "max_degraded_ok": true,
    "max_degraded_rate_ok": true,
    "max_nonempty_queue_runs_ok": true,
    "max_nonempty_queue_rate_ok": true,
    "max_malformed_ok": true
  },
  "strict_fail_count": 0,
  "strict_fail_reasons": []
}
