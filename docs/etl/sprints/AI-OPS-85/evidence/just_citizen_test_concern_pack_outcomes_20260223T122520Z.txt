node --test tests/test_citizen_concern_pack_outcomes_ui_contract.js
TAP version 13
# Subtest: citizen UI defines concern-pack outcome telemetry markers
ok 1 - citizen UI defines concern-pack outcome telemetry markers
  ---
  duration_ms: 1.320542
  ...
# Subtest: citizen UI records key concern-pack outcome events
ok 2 - citizen UI records key concern-pack outcome events
  ---
  duration_ms: 0.441583
  ...
1..2
# tests 2
# suites 0
# pass 2
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 44.217
python3 -m unittest tests/test_report_citizen_concern_pack_outcomes.py
...{
  "generated_at": "2026-02-23T12:25:20+00:00",
  "status": "degraded",
  "paths": {
    "events_jsonl": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpdprbnxsk/events.jsonl",
    "concern_pack_quality_json": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmpdprbnxsk/quality.json"
  },
  "telemetry": {
    "events_total": 0,
    "recognized_events_total": 0,
    "ignored_events_total": 0,
    "parse_errors": 0,
    "sessions_total": 0,
    "selected_pack_ids_total": 0
  },
  "metrics": {
    "pack_selected_events_total": 0,
    "topic_open_with_pack_events_total": 0,
    "weak_pack_selected_events_total": 0,
    "weak_pack_followthrough_events_total": 0,
    "unknown_pack_selected_events_total": 0,
    "pack_selected_sessions_total": 0,
    "weak_pack_selected_sessions_total": 0,
    "weak_pack_followthrough_sessions_total": 0,
    "weak_pack_followthrough_rate": null,
    "unknown_pack_select_share": null
  },
  "thresholds": {
    "min_pack_select_events": 20,
    "min_weak_pack_select_sessions": 5,
    "min_weak_pack_followthrough_rate": 0.3,
    "max_unknown_pack_select_share": 0.2
  },
  "checks": {
    "telemetry_available": false,
    "pack_select_events_meet_minimum": false,
    "weak_pack_select_sessions_meet_minimum": false,
    "weak_pack_followthrough_rate_meets_minimum": null,
    "unknown_pack_select_share_within_threshold": null,
    "contract_complete": false
  },
  "degraded_reasons": [
    "pack_select_events_below_minimum",
    "telemetry_missing",
    "weak_pack_select_sessions_below_minimum"
  ],
  "failure_reasons": [],
  "by_pack": []
}
{
  "generated_at": "2026-02-23T12:25:20+00:00",
  "status": "ok",
  "paths": {
    "events_jsonl": "/Users/jesus/Library/CloudStorage/GoogleDrive-gsus123456@gmail.com/My Drive/CdC/Obsidian Vault/vota-con-la-chola/tests/fixtures/citizen_concern_pack_outcome_events_sample.jsonl",
    "concern_pack_quality_json": "/Users/jesus/Library/CloudStorage/GoogleDrive-gsus123456@gmail.com/My Drive/CdC/Obsidian Vault/vota-con-la-chola/tests/fixtures/citizen_concern_pack_quality_sample.json"
  },
  "telemetry": {
    "events_total": 33,
    "recognized_events_total": 32,
    "ignored_events_total": 1,
    "parse_errors": 0,
    "sessions_total": 8,
    "selected_pack_ids_total": 5
  },
  "metrics": {
    "pack_selected_events_total": 24,
    "topic_open_with_pack_events_total": 7,
    "weak_pack_selected_events_total": 11,
    "weak_pack_followthrough_events_total": 7,
    "unknown_pack_selected_events_total": 2,
    "pack_selected_sessions_total": 8,
    "weak_pack_selected_sessions_total": 7,
    "weak_pack_followthrough_sessions_total": 7,
    "weak_pack_followthrough_rate": 1.0,
    "unknown_pack_select_share": 0.083333
  },
  "thresholds": {
    "min_pack_select_events": 20,
    "min_weak_pack_select_sessions": 5,
    "min_weak_pack_followthrough_rate": 0.3,
    "max_unknown_pack_select_share": 0.2
  },
  "checks": {
    "telemetry_available": true,
    "pack_select_events_meet_minimum": true,
    "weak_pack_select_sessions_meet_minimum": true,
    "weak_pack_followthrough_rate_meets_minimum": true,
    "unknown_pack_select_share_within_threshold": true,
    "contract_complete": true
  },
  "degraded_reasons": [],
  "failure_reasons": [],
  "by_pack": [
    {
      "pack_id": "economia",
      "pack_selected_events": 8,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "mystery_pack",
      "pack_selected_events": 2,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "sanidad",
      "pack_selected_events": 5,
      "topic_open_with_pack_events": 3,
      "weak_pack_selected_events": 5,
      "weak_pack_followthrough_events": 3
    },
    {
      "pack_id": "transparencia",
      "pack_selected_events": 3,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "vivienda",
      "pack_selected_events": 6,
      "topic_open_with_pack_events": 4,
      "weak_pack_selected_events": 6,
      "weak_pack_followthrough_events": 4
    }
  ]
}
{
  "generated_at": "2026-02-23T12:25:20+00:00",
  "status": "failed",
  "paths": {
    "events_jsonl": "/Users/jesus/Library/CloudStorage/GoogleDrive-gsus123456@gmail.com/My Drive/CdC/Obsidian Vault/vota-con-la-chola/tests/fixtures/citizen_concern_pack_outcome_events_sample.jsonl",
    "concern_pack_quality_json": "/Users/jesus/Library/CloudStorage/GoogleDrive-gsus123456@gmail.com/My Drive/CdC/Obsidian Vault/vota-con-la-chola/tests/fixtures/citizen_concern_pack_quality_sample.json"
  },
  "telemetry": {
    "events_total": 33,
    "recognized_events_total": 32,
    "ignored_events_total": 1,
    "parse_errors": 0,
    "sessions_total": 8,
    "selected_pack_ids_total": 5
  },
  "metrics": {
    "pack_selected_events_total": 24,
    "topic_open_with_pack_events_total": 7,
    "weak_pack_selected_events_total": 11,
    "weak_pack_followthrough_events_total": 7,
    "unknown_pack_selected_events_total": 2,
    "pack_selected_sessions_total": 8,
    "weak_pack_selected_sessions_total": 7,
    "weak_pack_followthrough_sessions_total": 7,
    "weak_pack_followthrough_rate": 1.0,
    "unknown_pack_select_share": 0.083333
  },
  "thresholds": {
    "min_pack_select_events": 20,
    "min_weak_pack_select_sessions": 5,
    "min_weak_pack_followthrough_rate": 0.3,
    "max_unknown_pack_select_share": 0.05
  },
  "checks": {
    "telemetry_available": true,
    "pack_select_events_meet_minimum": true,
    "weak_pack_select_sessions_meet_minimum": true,
    "weak_pack_followthrough_rate_meets_minimum": true,
    "unknown_pack_select_share_within_threshold": false,
    "contract_complete": false
  },
  "degraded_reasons": [],
  "failure_reasons": [
    "unknown_pack_select_share_above_threshold"
  ],
  "by_pack": [
    {
      "pack_id": "economia",
      "pack_selected_events": 8,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "mystery_pack",
      "pack_selected_events": 2,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "sanidad",
      "pack_selected_events": 5,
      "topic_open_with_pack_events": 3,
      "weak_pack_selected_events": 5,
      "weak_pack_followthrough_events": 3
    },
    {
      "pack_id": "transparencia",
      "pack_selected_events": 3,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "vivienda",
      "pack_selected_events": 6,
      "topic_open_with_pack_events": 4,
      "weak_pack_selected_events": 6,
      "weak_pack_followthrough_events": 4
    }
  ]
}
{
  "generated_at": "2026-02-23T12:25:20+00:00",
  "status": "failed",
  "paths": {
    "events_jsonl": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmp769to010/events.jsonl",
    "concern_pack_quality_json": "/var/folders/mq/m2lss7dj6gjg_kzf2_zpls500000gn/T/tmp769to010/quality.json"
  },
  "telemetry": {
    "events_total": 20,
    "recognized_events_total": 20,
    "ignored_events_total": 0,
    "parse_errors": 0,
    "sessions_total": 10,
    "selected_pack_ids_total": 2
  },
  "metrics": {
    "pack_selected_events_total": 20,
    "topic_open_with_pack_events_total": 0,
    "weak_pack_selected_events_total": 6,
    "weak_pack_followthrough_events_total": 0,
    "unknown_pack_selected_events_total": 0,
    "pack_selected_sessions_total": 10,
    "weak_pack_selected_sessions_total": 6,
    "weak_pack_followthrough_sessions_total": 0,
    "weak_pack_followthrough_rate": 0.0,
    "unknown_pack_select_share": 0.0
  },
  "thresholds": {
    "min_pack_select_events": 20,
    "min_weak_pack_select_sessions": 5,
    "min_weak_pack_followthrough_rate": 0.3,
    "max_unknown_pack_select_share": 0.2
  },
  "checks": {
    "telemetry_available": true,
    "pack_select_events_meet_minimum": true,
    "weak_pack_select_sessions_meet_minimum": true,
    "weak_pack_followthrough_rate_meets_minimum": false,
    "unknown_pack_select_share_within_threshold": true,
    "contract_complete": false
  },
  "degraded_reasons": [],
  "failure_reasons": [
    "weak_pack_followthrough_below_threshold"
  ],
  "by_pack": [
    {
      "pack_id": "economia",
      "pack_selected_events": 14,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 0,
      "weak_pack_followthrough_events": 0
    },
    {
      "pack_id": "vivienda",
      "pack_selected_events": 6,
      "topic_open_with_pack_events": 0,
      "weak_pack_selected_events": 6,
      "weak_pack_followthrough_events": 0
    }
  ]
}.
----------------------------------------------------------------------
Ran 4 tests in 0.005s

OK

